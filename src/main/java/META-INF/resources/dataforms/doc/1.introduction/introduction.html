<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<link type="text/css" href="../css/document.css" rel="stylesheet" />
		<style type="text/css">
		</style>
		<title>概要</title>
	</head>
	<body>
		<h1><span>1.</span>概要</h1>
		<h2>開発の目的</h2>
		<p>
			dataforms2.jarはJavaでWebアプリケーションを作るためフレームワークです。
		</p>
		<p>
			WebアプリケーションはM(Model),V(View),C(Controller)モデルに準拠した作りが良いとされています。
			JavaにはM,V,Cにそれぞれ複数のライブラリが存在し、それを組み合わせてアプリケーションを作るケースが多いようです。
			このようなライブラリは非常に便利です。しかし、これらのライブラリはどんどん複雑になり巨大化しています。
			さらに、依存ライブラリの数も増加しています。
			そのため、ちょっとしたシステムを作っただけなのに、数分かけて巨大なwarを作る作業を散々繰り返す羽目になってしまいます。
		</p>
		<p>
			ということで、M,V,Cの全てをシンプルなオリジナルライブラリで作成し、1つのjarファイルにまとめてみました。
			ついでに、今まで経験した既存のフレームワークの問題点を幾つか解決してみようと思い、このプロジェクトを開始しました。
		</p>
		<h2>特徴</h2>
		<p>
			このフレームワークの特徴を以下にまとめます。
		</p>
		<h3>1つのjarファイルにまとまっている</h3>
		<p>
			このフレームワークの本体は、1つのjarファイル(dataforms2.jar)にまとまっています。
			dataforms2.jarには、ライブラリ本体、アプリケーションの基本機能、開発ツールが入っています。
			Servletクラスもdataforms2.jarに入っており、web.xmlに設定を記述しなくても、*.dfというパターンで、DataFormsServletというServletが動作するようになっています。
			基本機能や開発ツールなどのページを構成するHTMLやJavascriptも、dataforms2.jarファイル中のMETA-INF/resourcesに入っています。
			(これらはServlet 3.0でサポートされた機能を使用しています。)
			基本的にWEB-INF/libにdataforms2.jarと幾つかの依存ライブラリをコピーし、web.xmlにJNDIデータソースの設定を記述すれば動作します。
		</p>
		<h3>依存ライブラリが少ない</h3>
		<p>
			このフレームワークの作成動機には、Javaで作成するWebアプリケーションの肥大化の問題があります。
			そのため、依存するライブラリは以下のものに抑えています。
		</p>
		<table class="jarlist">
			<caption>
				依存ライブラリ一覧
			</caption>
			<thead>
				<tr>
					<th style="width: 100px;">グルーブ</th>
					<th style="width: 300px;">ファイル</th>
					<th style="width: 400px;">コメント</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td rowspan="4">Javascriptライブラリ</td>
					<td>jQuery</td>
					<td rowspan="3">jQuery関連</td>
				</tr>
				<tr>
					<td>jQuery-ui</td>
				</tr>
				<tr>
					<td>jquery-ui-touch-punch</td>
				</tr>
				<tr>
					<td>ajaxzip3</td>
					<td>郵便番号住所変換</td>
				</tr>
				<tr>
					<td rowspan="4">apache commons</td>
					<td>commons-fileupload-XXX.jar</td>
					<td>ファイルのアップロード</td>
				</tr>
				<tr>
					<td>commons-io-XXX.jar</td>
					<td></td>
				</tr>
				<tr>
					<td>commons-text-XXX.jar</td>
					<td></td>
				</tr>
				<tr>
					<td>commons-validator-XXX.jar</td>
					<td>入力値のバリデーション</td>
				</tr>
				<tr>
					<td>jsonic</td>
					<td>jsonic-XXX.jar</td>
					<td>JSON変換</td>
				</tr>
				<tr>
					<td>apache log4j2</td>
					<td>log4j-core-XXX.jar</td>
					<td>ログ出力</td>
				</tr>
				<tr>
					<td rowspan="3">apache POI</td>
					<td>poi-XXX.jar</td>
					<td rowspan="3">
						Excel出力で使用<br/>
						(Excel出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>poi-ooxml-XXX.jar</td>
				</tr>
				<tr>
					<td>poi-scratchpad-XXX.jar</td>
				</tr>
				<tr>
					<td>apache fop</td>
					<td>fop-XXX.jar</td>
					<td>
						PDF出力<br/>
						(PDF出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>google.zxing</td>
					<td>javase-XXX.jar</td>
					<td>
						QR-Code生成<br/>
						(QR-Code出力を使用しない場合は削除できます)
					</td>
				</tr>
			</tbody>
		</table>
		<p>
			この中で一番大きいのがPOIなのですが、Excelレポート出力を使用しないのであればPOIは不要です。
			また、PDF出力が不要であればFOPも不要です。
		</p>
		<p class="topic">
			依存ライブラリ中のjarファイル一覧はpom.xmlの&lt;dependencies&gt;&lt;/dependencies&gt;に登録してあるもののみを挙げており、
			これらのライブラリが依存しているものは記載していません。
		</p>
		<h3>開発ツールを装備</h3>
		<p>
			データベース上にテーブルを定義し、それを操作するページを作成する流れは以下のようになります。
		</p>
		<h4>開発手順の概要</h4>
		<ol>
			<li>Tableクラスから派生したテーブルのJavaクラスを作成。</li>
			<li>テーブルJavaクラスからデータベース中にテーブルを作成。</li>
			<li>必要に応じて問合せクラスを作成。</li>
			<li>DAO(Database Access Object)クラスを作成。</li>
			<li>ページクラスを作成。</li>
			<li>ページクラスをからHTMLやJavascriptを作成。</li>
		</ol>
		<p>
			とりあえず動作するページが、これらの作業だけで出来上がります。
			これらの作業の大半は、開発ツールの操作だけでコーディングを行わずに完了します。
			開発ツールで自動生成されたコードは、可読性の高いものになっています。
			後はJavadocとJsdocを参照しながら、機能を追加していくことになります。
		</p>
		<h3>データベースの構造変更が容易</h3>
		<p>
			テスト用のデータがそろった段階でデータベースの構造を変更する場合、
			データを維持しながらデータベースの構造を変更するスクリプトを作る必要があります。
			そのため、データベースの構造変更にかかるコストは、かなり大きいものになります。
		</p>
		<p>
			ウォーターフォールモデルを採用したプロジェクトでは、
			データベースの構造を設計行程で確定し、後工程での構造変更を防止します。
			このため、設計工程のコストが、大きくなってしまいます。
			また、どんなに設計コストをかけても、テーブル構造の問題が後工程で見つかるケースは無くなりません。
		</p>
		<p>
			アジャイル開発を採用したプロジェクトでは、厳密な設計を行わず製造を進めていきます。
			そのため、設計にかかるコストは下がりますが、テーブル構造の変更が頻繁に発生する可能性があります。
		</p>
		<p>
			中小のシステムではアジャイル開発で行うケースが多いため、
			dataforms2.jarはデータベース構造の変更コストを下げる機能を装備しています。
		</p>
		<p>
			dataforms2.jarでテーブル構造を変更する作業は、テーブルJavaクラスの修正を行い、
			開発ツールの「テーブル管理」を使用し、その変更をデータベースに適用するだけで完了します。
			各データベースサーバのマニュアルを調べて、テーブル修正用のスクリプトを作成する作業は不要です。
			また、テーブル中のデータも可能な限り保持されます。
		</p>
		<p>
			旧バージョンのdataforms.jarで作成したシステムで、年数回テーブル構造の変更を伴うメンテナンスが発生しているものがあります。
			そのようなシステムでも特にトラブルなく運用を継続している実績があります。
		</p>
		<h3>複数のデータベースサーバに対応</h3>
		<p>
			データベースの操作は独自のJavaクラスライブラリで行います。ほとんどSQLを記述するケースはありません。
			今のところ以下のデータベースに対応しており、このクラスライブラリを使用している限り、ソースコードの修正なしにデータベースを切り替えることができます。
		</p>
		<h4>対応しているデータベースサーバ</h4>
		<ol>
			<li>Apache Derby</li>
			<li>MySQL</li>
			<li>PostgreSQL</li>
			<li>Oracle</li>
			<li>Microsoft SQL Server</li>
		</ol>
		<p>
			dataforms2.jarの開発では、開発環境は環境構築が容易なApache Derbyを使用し、結合テスト～運用はPostgreSQL等のデータベースサーバを使用することが一般化しています。
		</p>
		<p>
			データベースサーバに依存したSQLも、簡単に実行することができます。
			この場合はデータベースに合わせたコーディングが必要になります。
		</p>
		<h3>クラス化されたJavascriptライブラリ</h3>
		<p>
			Javaのページクラスにはフォームクラスのオブジェクトが配置され、フォームクラスにはフィールドクラスのオブジェクトが配置されています。
			dataforms2.jarでは、これらのJavaクラスに対応するJavascriptのクラスがES6の文法で記述されています。
			(Javascriptクラスが存在しなければ、親クラスのJavascriptクラスが自動的に操作します。)
			Javascriptクラスは、開発ツールで簡単に作成することができます。
			開発ツールで作成したJavascriptクラスに特殊な処理を記述することにより、独自の機能を追加していくとこができます。
		</p>
		<h3>ページの標準動作はクラスライブラリで実装済み</h3>
		<p>
			Javaのページクラスには複数のフォームクラスを配置できます。
			配置するフォームには以下の3種類が存在します。
		</p>
			<table>
				<caption>
					フォームクラスの種類
				</caption>
				<thead>
					<tr>
						<th>
							フォームクラス名
						</th>
						<th>
							説明
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>QueryForm</td>
						<td>
							問い合わせのための条件を入力し、問い合わせを実行するフォームです。
						</td>
					</tr>
					<tr>
						<td>QueryResultForm</td>
						<td>
							QueryFormで入力した条件を元に問い合わせを行い、その結果を表示するフォームです。
						</td>
					</tr>
					<tr>
						<td>EditForm</td>
						<td>
							指定されたデータの入力、編集を行うためのフォームです。
						</td>
					</tr>
				</tbody>
			</table>
		<p>
			開発ツールの「ページJavaクラス作成」では、これらの3種類のフォームの有無を指定できます。
			三種類全てのフォームを配置した場合、QueryFormに入力した条件を元にQueryResultFormが問い合わせ結果を表示します。
			表示したデータのリンクをクリックすると、EditFormが表示され、指定されたデータを編集することができます。
			このような動作はPageクラスと各種Formクラス中に実装されています。
			そのためフォームを配置するだけで、適切な動作をするアプリケーションになります。
		</p>
		<p>
			EditFormを省略すれは、問い合わせのみのページになります。
			また、EditFormのみを配置すれば、ユーザの登録情報の変更ページのように、決まったテーブルのレコードを修正するようなページを作ることもできます。
		</p>
		<p>
			EditFormの入力後確認ボタンを押下すると、EditFormがロックされ確認画面になります。
			他のフレームワークでは、これらの確認画面専用のHTMLを用意するケースを見かけますが、dataforms2.jarは編集用のフォームの各フィールドをロックすることによって実現しています。
			そのため、確認ページ用のHTMLを用意する必要がありません。
			確認画面が不要な場合、HTMLから「確認」ボタンを削除してください。
			これだけで最初から登録ボタンが表示され、確認画面を経由せず保存できるようになります。
		</p>
		<p>
			dataforms2.jarでは、HTMLの&lt;table&gt;タグに対応するHtmlTableクラスが用意されています。
			HtmlTableクラスのサブクラスには、以下の物があります。
		</p>

		<table>
			<caption>テーブルクラスの種類</caption>
			<thead>
				<tr>
					<th>
						テーブルクラス名
					</th>
					<th>
						説明
					</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>HtmlTable</td>
					<td>
						テーブルにデータを表示するだけの単純なテーブルです。
					</td>
				</tr>
				<tr>
					<td>PageScrollHtmlTable</td>
					<td>
						指定した件数でページスクロールする機能をサポートしたテーブルです。
						通常QueryResultFormに配置します。
					</td>
				</tr>
				<tr>
					<td>EdiableHtmlTable</td>
					<td>
						編集可能なテーブルクラスです。行の追加、削除、ドラッグによる順序変更をサポートします。
					</td>
				</tr>
			</tbody>
		</table>
		<p>
			これらのテーブルクラスをフォームに配置するだけで、標準的なイベント処理が自動的に組み込まれます。
		</p>
		<h3>アプリケーションの基本機能を装備</h3>
		<p>
			dataforms2.jarの中には、開発ツールの他にユーザの管理、ログインログアウトの機能を標準装備しています。
			これらの機能の実装は単純ですが、システムごとに実装するのも意外と面倒なものです。
			dataforms2.jarを使用すれば、このような手間をなくすことができます。
		</p>
		<p>
			また、これらの機能は必要最小限のものになっています。
			そのため、既存のページを機能が追加された別のページに差し替える機能を持っています。
		</p>
		<h3>デザイナーさんにお任せできるViewの実現</h3>
		<p>
			開発ツールで作成されたHTMLを確認してみるとわかると思いますが、
			標準的なHTMLのみで、Javascript、onxxxx等のイベント関連アトリビュート、ライブラリが定義する特殊なアトリビュートも存在しません。
			これが何故動作するのか不思議に思うかもしれませんが、dataforms2.jarがこのページの初期化スクリプトを自動的に生成するので、
			所定のイベント処理が自動的に組み込まれます。
			つまりHTMLは純粋に見た目だけを記述することになり、外見はHTMLやCSSの文法を理解しているデザイナーさんにお任せすることができます。
		</p>
		<h3>フレームデザインの共通化</h3>
		<p>
			dataforms2.jarでは、各ページに共通したフレームデザインが設定されており、それを切り替えることが可能です。
			dataforms2.jarの中には、/frame/flexというパスにFrameデザインを記録したHTMLやcssが入っています。
			デザイン性を重視しない場合はこのまま使用してもよいですし、デザインに凝りたい場合、これをカスタマイズすることも可能です。
		</p>
		<p class="topic">
			dataforms2.jarの中には旧バージョンの互換性を維持するため/frame/defaultというフレームデザインも残っています。
			これはtableタグを利用してページのレイアウトを設定しています。
		</p>
		<p>
			各ページのHTMLは、body直下に"mainDiv"というIDのdivが存在し、そのmainDivの中にページ固有の内容が記述されています。
			このページはそのままブラウザに転送され、その後ページの初期化スクリプトでFrame.htmlからヘッダ、フッタ、メニューなどを取得しmainDivの周りに配置します。
		</p>
		<h3>デバイスに依存しないフレームデザイン(レスポンシブデザイン)</h3>
		<p>
			現在のWebアプリケーションは、PCだけでなく、タブレット、スマートフォンに対応する必要があります。
			dataforms2.jarに含まれる各種スタイルシートにはPC用スタイル、タブレット用スタイル、スマートフォン用スタイルが設定されています。
			PCのブラウザでdataforms2.jarの各ページを表示し、ブラウザのサイズを変更すると、各画面サイズに応じてレイアウトが変化するようになっています。
		</p>
		<h3>多言語対応</h3>
		<p>
			各言語用のhtmlやpropertiesを用意することによって、ブラウザに設定された言語に応じて、出力するHTMLを切り替えることができます。
			dataforms2.jar内のページは英語と日本語のHTMLが作成されています。
		</p>
		<hr/>
	</body>
</html>
